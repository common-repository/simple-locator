var SimpleLocatorAdmin=SimpleLocatorAdmin||{};SimpleLocatorAdmin.Modals=function(){var o=this,a=jQuery;return o.activeBtn="",o.activeModal="",o.modalOpen=!1,o.selectors={toggleBtn:"[data-wpsl-modal-toggle]",backdrop:"[data-wpsl-modal-backdrop]",closeBtn:"[data-wpsl-modal-close]"},o.bindEvents=function(){a(document).on("click",o.selectors.toggleBtn,function(e){e.preventDefault(),o.activeBtn=a(this),o.openModal()}),a(document).on("click",o.selectors.closeBtn,function(e){e.preventDefault(),o.closeModals()}),a(document).on("open-wpsl-modal-manual",function(e,t){o.activeModal=a('*[data-wpsl-modal="'+t+'"]'),console.log(o.activeModal),o.openModal()}),a(document).on("close-wpsl-modal-manual",function(e){o.closeModals()}),a(document).on("click",o.selectors.backdrop,function(e){o.closeModals()})},o.openModal=function(){var e;o.modalOpen?o.closeModals():(0<a(o.activeBtn).length&&(e=a(o.activeBtn).attr("data-wpsl-modal-toggle"),o.activeModal=a('*[data-wpsl-modal="'+e+'"]')),a(o.activeModal).addClass("active"),o.modalOpen=!0,a(document).trigger("open-wpsl-modal",[o.activeBtn,o.activeModal]))},o.closeModals=function(){o.modalOpen=!1,a("[data-wpsl-modal]").removeClass("active"),a(document).trigger("close-wpsl-modal",[o.activeBtn,o.activeModal])},o.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).GeneralSettings=function(){var l=this,s=jQuery;return l.selectors={geoEnableCheckbox:"data-simple-locator-geo-enabled-checkbox",locationButtonText:"data-simple-locator-location-button-text",uploadMapPinButton:"data-simple-locator-upload-pin-button",removeMapPinButton:"data-simple-locator-remove-pin-button",mapPinImage:"data-simple-locator-map-pin-image",mapPinInput:"data-simple-locator-map-pin-input",mapPinContainer:"data-simple-locator-map-pin-image-container",userMapPin:"data-simple-locator-user-map-pin",userPinCheckbox:"data-simple-locator-toggle-user-pin"},l.bindEvents=function(){s(document).ready(function(){l.toggleLocationButtonText(),l.toggleUserPin()}),s(document).on("change","["+l.selectors.geoEnableCheckbox+"]",function(){l.toggleLocationButtonText()}),s(document).on("click","["+l.selectors.uploadMapPinButton+"]",function(e){e.preventDefault(),l.openMediaLibrary(s(this))}),s(document).on("click","["+l.selectors.removeMapPinButton+"]",function(e){e.preventDefault(),l.removeMapPin(s(this))}),s(document).on("change","["+l.selectors.userPinCheckbox+"]",function(){l.toggleUserPin()})},l.toggleLocationButtonText=function(){var e=s("["+l.selectors.locationButtonText+"]");if(s("["+l.selectors.geoEnableCheckbox+"]").is(":checked"))return"https:"!==location.protocol&&s("[data-simple-locator-no-https]").show(),void s(e).show();s("[data-simple-locator-no-https]").hide(),s(e).hide()},l.removeMapPin=function(e){var t=s(e).parent(".field"),o=s(t).find("["+l.selectors.mapPinInput+"]");s(t).find("["+l.selectors.mapPinContainer+"]").html(""),s(t).find("["+l.selectors.mapPinInput+"]").val("");e='<input id="upload_image_button" type="button" value="'+wpsl_locator.upload+'" class="button action" '+l.selectors.uploadMapPinButton+" />";s(e).insertBefore(o),s(t).find("["+l.selectors.removeMapPinButton+"]").remove()},l.addMapPin=function(e,t){var o=s(t).parent(".field"),a='<img src="'+e+'" id="map-pin-image" '+l.selectors.mapPinImage+" />",t='<input type="button" value="'+wpsl_locator.remove+'" class="button action" style="margin-right:5px;margin-left:10px;" '+l.selectors.removeMapPinButton+" />";s(o).find("["+l.selectors.mapPinContainer+"]").html(a);a=s(o).find("["+l.selectors.mapPinInput+"]");s(t).insertBefore(a),s(o).find("["+l.selectors.uploadMapPinButton+"]").remove(),s(o).find("["+l.selectors.mapPinInput+"]").val(e)},l.openMediaLibrary=function(t){mediaUploader=wp.media.frames.file_frame=wp.media({title:"Choose Map Pin",button:{text:"Choose Map Pin"},multiple:!1}),mediaUploader.on("select",function(){var e=mediaUploader.state().get("selection").first().toJSON();l.addMapPin(e.url,t)}),mediaUploader.open()},l.toggleUserPin=function(){s("["+l.selectors.userPinCheckbox+"]").is(":checked")?s("["+l.selectors.userMapPin+"]").show():s("["+l.selectors.userMapPin+"]").hide()},l.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).PostType=function(){var a=this,l=jQuery;return a.selectors={postTypeField:"data-simple-locator-post-type-field",postTypeLabels:"data-simple-locator-post-type-labels",latitudeSelectField:"data-simple-locator-latitude-select",longitudeSelectField:"data-simple-locator-longitude-select",latitudeField:"data-simple-locator-latitude-field",longitudeField:"data-simple-locator-longitude-field",useLocatorFieldsRadio:"data-simple-locator-use-included-fields",useCustomFieldsRadio:"data-simple-locator-use-custom-fields",latLngOptions:"data-simple-locator-lat-lng-options",showHiddenCheckbox:"data-simple-locator-show-hidden",hidePostTypeCheckbox:"data-simple-locator-hide-post-type",hideIncludedFieldsCheckbox:"data-simple-locator-hide-included-fields",resetButton:"data-simple-locator-reset-post-type",resetButtonCheckbox:"data-simple-locator-resest-post-type-checkbox",acfMapField:"data-simple-locator-acf-map-field"},a.bindEvents=function(){l(document).ready(function(){a.togglePostTypeLabels(),a.toggleCustomFieldOptions(),a.toggleHideDefaultCheckbox(),a.toggleHideIncludedFieldsCheckbox(),a.loadPostTypeFields(),a.toggleAcfMapField()}),l(document).on("change","["+a.selectors.postTypeField+"]",function(){a.togglePostTypeLabels(),a.loadPostTypeFields(),a.toggleHideDefaultCheckbox(),a.toggleHideIncludedFieldsCheckbox()}),l(document).on("change","["+a.selectors.latitudeSelectField+"],["+a.selectors.longitudeSelectField+"]",function(){a.updateLatLngValues()}),l(document).on("change","["+a.selectors.useLocatorFieldsRadio+"],["+a.selectors.useCustomFieldsRadio+"]",function(){l("["+a.selectors.useLocatorFieldsRadio+"]").is(":checked")&&a.selectLocationFields(),a.toggleAcfMapField(),a.toggleCustomFieldOptions(),a.toggleHideIncludedFieldsCheckbox()}),l(document).on("change","["+a.selectors.showHiddenCheckbox+"]",function(){a.loadPostTypeFields()}),l(document).on("click","["+a.selectors.resetButton+"]",function(e){return e.preventDefault(),!!confirm("Are you sure you want to reset to the default post type?")&&void a.resetPostType()}),l(document).on("change","["+a.selectors.resetButtonCheckbox+"]",function(){var e=l("["+a.selectors.resetButton+"]");l(this).is(":checked")?l(e).show():l(e).hide()})},a.togglePostTypeLabels=function(){var e=l("["+a.selectors.postTypeLabels+"]");l("["+a.selectors.postTypeField+"]").val()!==wpsl_locator.posttype?l(e).hide():l(e).show()},a.loadPostTypeFields=function(){var e=l("["+a.selectors.postTypeField+"]").val();l("["+a.selectors.useLocatorFieldsRadio+"]").is(":checked")?a.selectLocationFields():(l("["+a.selectors.latitudeSelectField+"],["+a.selectors.longitudeSelectField+"]").empty(),a.getCustomFields(e))},a.selectLocationFields=function(){l("["+a.selectors.useCustomFieldsRadio+"]").is(":checked")||(l("["+a.selectors.useLocatorFieldsRadio+"]").attr("checked","checked"),l("["+a.selectors.useCustomFieldsRadio+"]").removeAttr("checked")),l("["+a.selectors.latitudeField+"]").val("wpsl_latitude"),l("["+a.selectors.longitudeField+"]").val("wpsl_longitude"),l("["+a.selectors.latitudeSelectField+"]").val("wpsl_latitude"),l("["+a.selectors.longitudeSelectField+"]").val("wpsl_longitude")},a.getCustomFields=function(t){var e=l("["+a.selectors.showHidden+"]").is(":checked")?"true":"false",o=l("["+a.selectors.useLocatorFieldsRadio+"]").is(":checked")?"true":"false";l.ajax({type:"GET",url:ajaxurl,data:{action:"wpslposttype",nonce:wpsl_locator.locatorNonce,post_type:t,show_hidden:e,include_wpsl:o},success:function(e){l("["+a.selectors.latitudeSelectField+"],["+a.selectors.longitudeSelectField+"]").html(e.fields),a.updateLatLngValues(),"location"===t&&a.selectLocationFields()}})},a.toggleCustomFieldOptions=function(){var e=l("["+a.selectors.latLngOptions+"]");l("["+a.selectors.useCustomFieldsRadio+"]").is(":checked")?l(e).show():l(e).hide()},a.updateLatLngValues=function(){var e=l("["+a.selectors.latitudeSelectField+"]").val(),t=l("["+a.selectors.longitudeSelectField+"]").val();l("["+a.selectors.latitudeField+"]").val(e),l("["+a.selectors.longitudeField+"]").val(t)},a.toggleHideDefaultCheckbox=function(){var e=l("["+a.selectors.postTypeField+"]").val(),t=l("["+a.selectors.hidePostTypeCheckbox+"]"),o=l(t).parents(".row");if(e===wpsl_locator.posttype)return l(t).removeAttr("checked"),void l(o).hide();l(o).show()},a.toggleHideIncludedFieldsCheckbox=function(){var e=l("["+a.selectors.hideIncludedFieldsCheckbox+"]"),t=l(e).parent("label").parent("p");if(!!l("["+a.selectors.useLocatorFieldsRadio+"]").is(":checked"))return l(e).removeAttr("checked"),void l(t).hide();l(t).show()},a.resetPostType=function(){l.ajax({type:"POST",url:ajaxurl,data:{action:"wpslresetposttype"},success:function(e){location.reload()}})},a.toggleAcfMapField=function(){l("["+a.selectors.useLocatorFieldsRadio+"]").is(":checked")?l("["+a.selectors.acfMapField+"]").hide():l("["+a.selectors.acfMapField+"]").show()},a.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).PostEdit=function(){var l=this,s=jQuery;return l.lookupaddress=!0,l.mappinrelocated=!1,l.selectors={inputAddress:"#wpsl_address",inputCity:"#wpsl_city",inputState:"#wpsl_state",inputZip:"#wpsl_zip",inputLatitude:"#wpsl_latitude",inputLongitude:"#wpsl_longitude",noAddressConfirm:"data-simple-locator-confirm-no-address",publishButton:"#publish",publishButtonGuttenberg:".editor-post-publish-button"},l.bindEvents=function(){s(window).on("load",function(){l.setMapPinStatus(),l.checkMapStatus(),l.groupIntoAcfTab(),"true"===s("#wpsl_custom_geo").val()&&(mappinrelocated=!0)}),s(document).on("click",".acf-tab-button",function(){l.checkMapStatus()}),s(document).on("click",l.selectors.publishButton+","+l.selectors.publishButtonGuttenberg,function(e){"wpsl_latitude"!==wpsl_locator.lat_field&&""!==wpsl_locator.map_field||l.lookupaddress&&(l.mappinrelocated||(e.preventDefault(),editScreenGoogleApiError?s(document).trigger("open-wpsl-modal-manual",["post-edit-error"]):(e=l.formatAddress(),l.googleGeocodeAddress(e))))}),s(document).on("click","["+l.selectors.noAddressConfirm+"]",function(e){e.preventDefault(),l.saveWithoutLocation()})},l.groupIntoAcfTab=function(){var e,t;wpsl_locator.acf_tab&&""!==wpsl_locator.acf_tab&&(t=wpsl_locator.acf_tab.replace("_","-"),s(e=".acf-"+t).length<1?s("#wpsl-meta-box").show():(e=s(".wpsl-meta").detach().addClass("acf-field acf-field-text").insertAfter(e).first(),t=s(".acf-tab-button[data-key="+wpsl_locator.acf_tab+"]").parent("li"),s(t).hasClass("active")||s(e).addClass("acf-hidden")))},l.setMapPinStatus=function(){l.mappinrelocated="true"==s("#wpsl_custom_geo").val()},l.formatAddress=function(){return s(l.selectors.inputAddress).val()+" "+s(l.selectors.inputCity).val()+" "+s(l.selectors.inputState).val()+" "+s(l.selectors.inputZip).val()},l.googleGeocodeAddress=function(e){geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,t){t==google.maps.GeocoderStatus.OK?(t=e[0].geometry.location.lat(),e=e[0].geometry.location.lng(),s(l.selectors.inputLatitude).val(t),s(l.selectors.inputLongitude).val(e),l.lookupaddress=!1,s(l.selectors.publishButton).click()):s(document).trigger("open-wpsl-modal-manual",["post-edit-error"])})},l.saveWithoutLocation=function(){s(document).trigger("close-wpsl-modal-manual"),l.lookupaddress=!1,s(l.selectors.publishButton).click()},l.checkMapStatus=function(){var e,t;0<s("#wpslmap").length&&(e=s(l.selectors.inputLatitude).val(),t=s(l.selectors.inputLongitude).val(),""!==e&&""!==t&&(s("#wpslmap").show(),l.loadGoogleMap(e,t)))},l.loadGoogleMap=function(e,t){var o=new google.maps.Map(document.getElementById("wpslmap"),{zoom:14,center:new google.maps.LatLng(e,t),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,scaleControl:!1}),a=new google.maps.Marker({position:new google.maps.LatLng(e,t),map:o,draggable:!0});google.maps.event.addListener(a,"drag",function(){s(l.selectors.inputLatitude).val(a.position.lat()),s(l.selectors.inputLongitude).val(a.position.lng()),s(l.selectors.inputLatitude+","+l.selectors.inputLongitude).attr("readonly",!1),s("#wpsl_custom_geo").val("true"),l.mappinrelocated=!0})},l.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).DefaultMap=function(){var n=this,i=jQuery;return n.selectors={showDefaultCheckbox:"data-simple-locator-default-checkbox",defaultMap:"data-simple-locator-default-map",defaultMapContainer:"data-simple-locator-default-map-container",zoomInput:"data-simple-locator-default-map-zoom",latitudeInput:"data-simple-locator-default-map-latitude",longitudeInput:"data-simple-locator-default-map-longitude",locationSearchButton:"data-simple-locator-location-search-button",locationSearchInput:"data-simple-locator-location-search-input",error:"data-simple-locator-error",centerUserPositionCheckbox:"data-simple-locator-user-position-default"},n.bindEvents=function(){i(document).ready(function(){i("["+n.selectors.defaultMap+"]").length<1||(n.toggleDefaultMap(),n.toggleHttpsWarning())}),i(document).on("change","["+n.selectors.showDefaultCheckbox+"]",function(){n.toggleDefaultMap()}),i(document).on("click","["+n.selectors.locationSearchButton+"]",function(e){e.preventDefault(),n.findLocation()}),i(document).on("change","["+n.selectors.centerUserPositionCheckbox+"]",function(){n.toggleHttpsWarning()})},n.toggleDefaultMap=function(){var e=i("["+n.selectors.showDefaultCheckbox+"]").is(":checked"),t=i("["+n.selectors.defaultMapContainer+"]");if(e)return i(t).show(),void n.loadDefaultMap();i(t).hide()},n.loadDefaultMap=function(e,t){t=void 0!==(e=void 0!==e&&""!==e&&e)&&""!==t&&t,e=e||wpsl_locator_defaultmap.latitude,t=t||wpsl_locator_defaultmap.longitude;var o=new google.maps.LatLng(e,t),a={center:o,zoom:parseInt(wpsl_locator_defaultmap.zoom),mapTypeControl:!1,streetViewControl:!1,styles:wpsl_locator_defaultmap.styles},l=new google.maps.Map(document.getElementById("wpsl-default"),a),s=new google.maps.Marker({position:o,map:l,icon:wpsl_locator_defaultmap.mappin,draggable:!0});e&&t&&(i("["+n.selectors.latitudeInput+"]").val(e),i("["+n.selectors.longitudeInput+"]").val(t)),google.maps.event.addListener(l,"zoom_changed",function(){var e=l.getZoom();i("["+n.selectors.zoomInput+"]").val(e)}),google.maps.event.addListener(s,"drag",function(){i("["+n.selectors.latitudeInput+"]").val(s.position.lat()),i("["+n.selectors.longitudeInput+"]").val(s.position.lng())})},n.findLocation=function(){n.toggleError(!1);var e=i("["+n.selectors.locationSearchInput+"]").val();geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,t){t!=google.maps.GeocoderStatus.OK?n.toggleError(!0):(t=e[0].geometry.location.lat(),e=e[0].geometry.location.lng(),n.loadDefaultMap(t,e))})},n.loadSearchResults=function(e,t){n.loadDefaultMap(e,t)},n.toggleError=function(e){e?i("["+n.selectors.error+"]").show():i("["+n.selectors.error+"]").hide()},n.toggleHttpsWarning=function(){i("["+n.selectors.centerUserPositionCheckbox+"]").is(":checked")?"https:"!==location.protocol&&i("[data-simple-locator-no-https]").show():i("[data-simple-locator-no-https]").hide()},n.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ResultsDisplay=function(){var t=this,o=jQuery;return t.bindEvents=function(){o(document).ready(function(){t.enableDatePicker()}),o(document).on("click",".wpsl-field-add",function(e){e.preventDefault(),t.addResultField()}),o(document).on("click",".wpsl-post-field-add",function(e){e.preventDefault(),t.addPostField()})},t.addResultField=function(){var e="["+o("#wpsl-fields").val()+"]";tinymce.activeEditor.execCommand("mceInsertContent",!1,e)},t.addPostField=function(){var e="["+o("#wpsl-post-fields").val()+"]";tinymce.activeEditor.execCommand("mceInsertContent",!1,e)},t.enableDatePicker=function(){o("[data-date-picker]").datepicker({beforeShow:function(e,t){o("#ui-datepicker-div").addClass("wpsl-datepicker")}})},t.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).MapDisplay=function(){var a=this,l=jQuery;return a.selectors={styleChoiceSelect:"data-simple-locator-map-style-choice",styleChoice:"data-simple-locator-map-style",styleList:"data-simple-locator-map-style-list",styleSelect:"data-simple-locator-map-style-select",styleChoiceInput:"data-simple-locator-map-style-choice-input",customOptionsCheckbox:"data-simple-locator-custom-map-options-checkbox",customOptions:"data-simple-locator-custom-map-options",customAutocompleteCheckbox:"data-simple-locator-custom-autocomplete-option",customAutocomplete:"data-simple-locator-custom-autocomplete",clusterRendererCheckbox:"data-simple-locator-custom-marker-clustering-option",clusterRenderer:"data-simple-locator-clustering-renderer"},a.bindEvents=function(){l(document).ready(function(){l("["+a.selectors.styleList+"]").length<1||a.buildMapChoices()}),l(document).on("change","["+a.selectors.styleChoiceSelect+"]",function(){var e=l(this).val();a.toggleChoice(e)}),l(document).on("click","["+a.selectors.styleSelect+"]",function(e){e.preventDefault(),a.selectStyle(l(this))}),l(document).on("change","["+a.selectors.customOptionsCheckbox+"]",function(){l(this).is(":checked")?l("["+a.selectors.customOptions+"]").show():l("["+a.selectors.customOptions+"]").hide()}),l(document).on("change","["+a.selectors.customAutocompleteCheckbox+"]",function(){a.toggleAutocompleteOptions()}),l(document).on("change","["+a.selectors.clusterRendererCheckbox+"]",function(){a.toggleClusterRenderer()})},a.toggleChoice=function(e){e=l("["+a.selectors.styleChoice+"="+e+"]");l("["+a.selectors.styleChoice+"]").hide(),l(e).show()},a.buildMapChoices=function(){l("["+a.selectors.styleList+"]").empty(),l.each(wpsl_locator_mapstyles,function(e,t){a.buildMapHtml(e,t),a.loadChoiceMap(t)})},a.buildMapHtml=function(e,t){var o='<li class="';e%3==0&&(o+="first"),t.selected&&(o+=" active"),o+='">',o+="<h4>"+t.title+"</h4>",o+='<div class="map" id="map_'+t.id+'"></div>',o+='<a href="'+t.id+'" class="choose-style" '+a.selectors.styleSelect+">",o+="Use Style",o+="</a>",o+="</li>",l("["+a.selectors.styleList+"]").append(o)},a.loadChoiceMap=function(e){var t=JSON.parse(e.styles),o="map_"+e.id,t={center:new google.maps.LatLng(40.7699354,-73.9810812),zoom:13,mapTypeControl:!1,streetViewControl:!1,styles:t},e=new google.maps.Map(document.getElementById(o),t)},a.selectStyle=function(e){var t=l(e).attr("href");l("["+a.selectors.styleChoiceInput+"]").val(t),l("["+a.selectors.styleList+"] li").removeClass("active"),l(e).parent("li").addClass("active")},a.toggleAutocompleteOptions=function(){l("["+a.selectors.customAutocompleteCheckbox+"]").is(":checked")?l("["+a.selectors.customAutocomplete+"]").show():l("["+a.selectors.customAutocomplete+"]").hide()},a.toggleClusterRenderer=function(){l("["+a.selectors.clusterRendererCheckbox+"]").is(":checked")?l("["+a.selectors.clusterRenderer+"]").show():l("["+a.selectors.clusterRenderer+"]").hide()},a.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).SearchHistory=function(){var p=this,u=jQuery;return p.locations,p.selectors={container:"data-simple-locator-search-history-map",perPage:"data-simple-locator-history-per-page"},p.bindEvents=function(){u(document).ready(function(){u("["+p.selectors.container+"]").length<1||(p.locations=search_history_locations,p.loadMap())}),u("["+p.selectors.perPage+"]").on("change",function(){u(this).parents("form").submit()})},p.loadMap=function(){for(var e=wpsl_locator_searchhistory.mapstyles,t=wpsl_locator_searchhistory.mappin||"",o=new google.maps.LatLngBounds,a=p.locations,l=u("["+p.selectors.container+"]"),e={mapTypeId:"roadmap",mapTypeControl:!1,zoom:8,styles:e,scrollwheel:!1,panControl:!1},s=new google.maps.InfoWindow,n=new google.maps.Map(l[0],e),i=0;i<a.length;i++){var r=new google.maps.LatLng(a[i].latitude,a[i].longitude);o.extend(r);r=new google.maps.Marker({position:r,map:n,title:a[i].search_term,icon:t});a[i].infowindow="<h4>"+a[i].date+"</h4>",a[i].infowindow+="<p>",a[i].infowindow+=wpsl_locator_searchhistory.searchTerm+": "+a[i].search_term,a[i].infowindow+="<br>"+wpsl_locator_searchhistory.searchTermFormatted+": "+a[i].search_term_formatted,a[i].infowindow+="<br>"+wpsl_locator_searchhistory.userIp+": "+a[i].user_ip,a[i].infowindow+="<br>"+wpsl_locator_searchhistory.distance+": "+a[i].distance,a[i].infowindow+="</p>",google.maps.event.addListener(r,"click",function(e,t){return function(){s.setContent(a[t].infowindow),s.open(n,e)}}(r,i)),n.fitBounds(o);var c=google.maps.event.addListener(n,"idle",function(){a.length<2&&n.setZoom(13),google.maps.event.removeListener(c)})}var d=google.maps.event.addListener(n,"bounds_changed",function(e){google.maps.event.removeListener(d)})},p.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ImportTest=function(){var t=this,o=jQuery;return t.selectors={button:"data-simple-locator-import-test-button",message:"data-simple-locator-import-test-message"},t.bindEvents=function(){o(document).on("click","["+t.selectors.button+"]",function(e){e.preventDefault(),t.test()})},t.test=function(){o.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"wpslimporttest",nonce:wpsl_locator.locatorNonce},success:function(e){"testing"!==e.status?"success"!==e.status?"error"===e.status&&o("["+t.selectors.message+"]").text(e.message).addClass("wpsl-error"):o("["+t.selectors.message+"]").text(e.message).addClass("wpsl-alert"):console.log(e)}})},t.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ImportUpload=function(){var o=this,a=jQuery;return o.selectors={startNewBtn:"data-simple-locator-import-start-new",uploadForm:"data-simple-locator-import-upload-form",previousImportMessage:"data-simple-locator-import-previous-message",postTypeInput:"data-simple-locator-import-post-type-input",toggleHiddenPostTypeCheckbox:"data-simple-locator-show-non-public-types",nonPublicPostType:"data-non-public-post-type",toggleImportDetails:"data-import-toggle-details",undoImportButton:"data-simple-locator-import-undo-button",redoImportButton:"data-simple-locator-import-redo-button",removeImportButton:"data-simple-locator-import-remove-button",toggleTemplateDetails:"data-import-template-toggle-details",removeTemplateButton:"data-simple-locator-remove-import-template",typeRadio:"data-simple-locator-import-type-radio"},o.bindEvents=function(){a(document).ready(function(){o.togglePublicPostTypes()}),a(document).on("change","["+o.selectors.toggleHiddenPostTypeCheckbox+"]",function(){o.togglePublicPostTypes()}),a(document).on("click","["+o.selectors.startNewBtn+"]",function(e){e.preventDefault(),o.startNewImport()}),a(document).on("click","["+o.selectors.toggleImportDetails+"]",function(e){e.preventDefault(),o.toggleImportDetails(a(this))}),a(document).on("click","["+o.selectors.undoImportButton+"]",function(e){e.preventDefault();e=a(this).attr(o.selectors.undoImportButton);o.undoImport(e)}),a(document).on("click","["+o.selectors.redoImportButton+"]",function(e){e.preventDefault();e=a(this).attr(o.selectors.redoImportButton);o.redoImport(e)}),a(document).on("click","["+o.selectors.removeImportButton+"]",function(e){e.preventDefault();e=a(this).attr(o.selectors.removeImportButton);o.removeImport(e)}),a(document).on("click","["+o.selectors.toggleTemplateDetails+"]",function(e){e.preventDefault(),o.toggleTemplateDetails(a(this))}),a(document).on("click","["+o.selectors.removeTemplateButton+"]",function(e){e.preventDefault();e=a(this).attr(o.selectors.removeTemplateButton);o.removeTemplate(e)}),a(document).on("change","["+o.selectors.typeRadio+"]",function(){o.toggleImportType()})},o.startNewImport=function(){a("["+o.selectors.uploadForm+"]").show(),a("["+o.selectors.previousImportMessage+"]").hide()},o.togglePublicPostTypes=function(){var e=a("["+o.selectors.nonPublicPostType+"]");a("["+o.selectors.toggleHiddenPostTypeCheckbox+"]").is(":checked")?a(e).show():a(e).hide()},o.toggleImportDetails=function(e){a(e).parents(".import").find(".import-body").toggle()},o.toggleTemplateDetails=function(e){a(e).parents(".import-template ").find(".details").toggle()},o.toggleImportType=function(){var e=a("["+o.selectors.typeRadio+"]:checked").val(),t=a("[data-import-type]");console.log(e),a(t).hide(),a('[data-import-type="'+e+'"]').show()},o.undoImport=function(e){confirm(wpsl_locator.confirm_undo)&&(a("#undo_import_id").val(e),a("[data-undo-import-form]").submit())},o.redoImport=function(e){confirm(wpsl_locator.confirm_redo)&&(a("#redo_import_id").val(e),a("[data-redo-import-form]").submit())},o.removeImport=function(e){confirm(wpsl_locator.confirm_remove)&&(a("#remove_import_id").val(e),a("[data-remove-import-form]").submit())},o.removeTemplate=function(e){confirm(wpsl_locator.confirm_remove_template)&&(a("#template_remove_id").val(e),a("[data-remove-import-template]").submit())},o.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ImportColumnMap=function(){var i=this,r=jQuery;return i.totalrows=0,i.rowcount=0,i.selectors={loadingIndicator:"data-simple-locator-import-loading",columnSelection:"data-simple-locator-import-column-selection",rowSelectionButton:"data-simple-locator-import-row-selection-button",rowSelectionButtonNext:'[data-simple-locator-import-row-selection-button="next"]',rowSelectionButtonBack:'[data-simple-locator-import-row-selection-button="back"]',currentRowText:"data-simple-locator-import-current-row",postType:"data-simple-locator-import-post-type",selectColumn:"data-simple-locator-import-column-select",selectField:"data-simple-locator-import-field-select",selectType:"data-simple-locator-import-type-select",addFieldButton:"data-simple-locator-import-add-field",removeFieldButton:"data-simple-locator-import-remove-field",saveButton:"data-simple-locator-import-save",formError:"data-simple-locator-form-error",columnError:"data-simple-locator-column-error",fieldRow:"data-simple-locator-import-field",form:"data-simple-locator-import-column-form",status:"data-import-post-status",taxonomySeparator:"data-import-taxonomy-separator",uniqueIdCheckbox:"data-simple-locator-import-unique-identifier",uniqueIdAction:"data-import-unique-action"},i.bindEvents=function(){r(document).ready(function(){"true"===wpsl_locator.isimport&&"2"===wpsl_locator.importstep&&(i.getColumns(),i.getPostTypeFields())}),r("["+i.selectors.rowSelectionButton+"]").on("click",function(e){e.preventDefault(),i.moveRowSelection(r(this))}),r(document).on("change","["+i.selectors.selectField+"]",function(){i.autoSelectFieldType(r(this)),i.toggleStatusSelection(),i.toggleFieldOptions(),i.toggleTaxonomySelector(),i.toggleUniqueIdCheckboxInRow()}),r(document).on("click","["+i.selectors.addFieldButton+"]",function(e){e.preventDefault(),i.addField()}),r(document).on("change","["+i.selectors.uniqueIdCheckbox+"]",function(e){i.toggleUniqueIdCheckbox(r(this))}),r(document).on("click","["+i.selectors.removeFieldButton+"]",function(e){e.preventDefault(),i.removeField(r(this))}),r(document).on("click","["+i.selectors.saveButton+"]",function(e){e.preventDefault(),r("["+i.selectors.formError+"],["+i.selectors.columnError+"]").hide(),i.validates()&&r("["+i.selectors.form+"]").submit()})},i.getColumns=function(){i.toggleLoading(!0),r.ajax({url:ajaxurl,type:"POST",datatype:"json",data:{action:"wpslimportcolumns",rowcount:i.rowcount,nonce:wpsl_locator.locatorNonce},success:function(e){i.totalrows=e.row_count,i.updateCurrentRowText(),i.addColumnRows(e),i.populateColumnSelects(e),i.selectColumns()}})},i.addColumnRows=function(e){for(var t=0;t<e.columns.length-1;t++)i.addField()},i.populateColumnSelects=function(e){var t=i.rowcount+1===e.row_count&&"disabled";r(i.selectors.rowSelectionButtonNext).attr("disabled",t);for(var o='<option value="">'+wpsl_locator.choose_column+"</option>",a=0;a<e.columns.length;a++)o+='<option value="'+a+'">'+e.columns[a]+"</option>";r("["+i.selectors.selectColumn+"]").html(o),i.toggleLoading(!1)},i.selectColumns=function(){var e=r("["+i.selectors.fieldRow+"]");r.each(e,function(e){var t=r(this).find("["+i.selectors.selectColumn+"]"),e=String(e);r(t).val(e)})},i.moveRowSelection=function(e){i.rowcount="next"===r(e).attr(i.selectors.rowSelectionButton)?i.rowcount+1:i.rowcount-1;e=0==i.rowcount&&"disabled";r(i.selectors.rowSelectionButtonBack).attr("disabled",e),i.getColumns()},i.updateCurrentRowText=function(){var e=wpsl_locator.Row+" "+(i.rowcount+1)+" of "+i.totalrows;r("["+i.selectors.currentRowText+"]").text(e)},i.getPostTypeFields=function(){r.ajax({type:"GET",url:ajaxurl,data:{action:"wpslposttype",nonce:wpsl_locator.locatorNonce,post_type:r("["+i.selectors.postType+"]").val(),show_hidden:"false",include_wpsl:"true"},success:function(e){i.populateWordPressFieldSelects(e)}})},i.populateWordPressFieldSelects=function(e){var t=r("["+i.selectors.selectField+"]"),o='<optgroup label="'+wpsl_locator.wordpress_fields+'">';o+='<option value="title">'+wpsl_locator.title+"</option>",o+='<option value="content">'+wpsl_locator.content+"</option>",o+='<option value="excerpt">'+wpsl_locator.excerpt+"</option>",o+='<option value="publish_date">'+wpsl_locator.publish_date+"</option>",o+='<option value="publish_date_gmt">'+wpsl_locator.publish_date_gmt+"</option>",o+='<option value="modified_date">'+wpsl_locator.modified_date+"</option>",o+='<option value="modified_date_gmt">'+wpsl_locator.modified_date_gmt+"</option>",o+='<option value="slug">'+wpsl_locator.slug+"</option>",o+='<option value="status">'+wpsl_locator.status+"</option>",o+="</optgroup>";var a='<optgroup label="'+wpsl_locator.custom_fields+'">';a+=e.fields,a+="</optgroup";e=e.taxonomies;taxonomy_fields=null,void 0!==e&&""!==e&&(taxonomy_fields='<optgroup label="'+wpsl_locator.taxonomies+'">',r.each(e,function(){taxonomy_fields+='<option value="taxonomy_'+this.name+'">'+this.label+"</option>"}),taxonomy_fields+="<optgroup>"),r.each(t,function(e,t){r(this).append(o),r(this).append(a),taxonomy_fields&&r(this).append(taxonomy_fields)})},i.autoSelectFieldType=function(e){var t=r(e).val(),e=r(e).next("["+i.selectors.selectType+"]");"wpsl_address"===t&&r(e).val("address"),"wpsl_city"===t&&r(e).val("city"),"wpsl_state"===t&&r(e).val("state"),"wpsl_zip"===t&&r(e).val("zip"),"wpsl_website"===t&&r(e).val("website")},i.addField=function(){var e=r(".wpsl-field").length,t=r(".row-template").clone().removeClass("row-template");r(t).appendTo(".wpsl-column-fields").find("["+i.selectors.removeFieldButton+"]").show(),r(t).find(".wpsl-column-error").text("").hide(),r(t).find("["+i.selectors.selectField+"]").attr("name","wpsl_import_field["+e+"][field]");r(t).find("["+i.selectors.selectColumn+"]").attr("name","wpsl_import_field["+e+"][csv_column]");r(t).find("["+i.selectors.selectType+"]").attr("name","wpsl_import_field["+e+"][type]"),r(t).find("["+i.selectors.uniqueIdCheckbox+"]").attr("name","wpsl_import_field["+e+"][unique]").removeAttr("checked")},i.removeField=function(e){e=r(e).parent("li");r(e).remove()},i.validates=function(){var l=!1,s=!1,n=!0;return r.each(r("["+i.selectors.fieldRow+"]"),function(e,t){var o=r(this).find("["+i.selectors.selectColumn+"]"),a=r(this).find("["+i.selectors.selectField+"]");""!==r(o).val()&&""!==r(a).val()||(r(this).find("["+i.selectors.columnError+"]").text(wpsl_locator.required).show(),n=!1);o=r(this).find("["+i.selectors.selectType+"]");"address"!==r(o).val()&&"full_address"!==r(o).val()||(s=!0),"title"===r(a).val()&&(l=!0)}),s||(r("["+i.selectors.formError+"]").html("<p>"+wpsl_locator.required_address+"</p>").show(),n=!1),l||(r("["+i.selectors.formError+"]").html("<p>"+wpsl_locator.required_title+"</p>").show(),n=!1),n},i.toggleUniqueIdCheckbox=function(e){var t=r(e).is(":checked"),o=r("["+i.selectors.uniqueIdAction+"]");t?(r("["+i.selectors.uniqueIdCheckbox+"]").removeAttr("checked"),r(e).attr("checked",!0),r(o).show()):r(o).hide()},i.toggleStatusSelection=function(){var e=!1,t=r("["+i.selectors.selectField+"]");r.each(t,function(){"status"===r(this).val()&&(e=!0)}),e?r("["+i.selectors.status+"]").hide():r("["+i.selectors.status+"]").show()},i.toggleTaxonomySelector=function(){var e=!1,t=r("["+i.selectors.selectField+"]");r.each(t,function(){r(this).val().includes("taxonomy_")&&(e=!0)}),e?r("["+i.selectors.taxonomySeparator+"]").show():r("["+i.selectors.taxonomySeparator+"]").hide()},i.toggleFieldOptions=function(){var o=[],e=r("["+i.selectors.selectField+"]");r.each(e,function(){""!==r(this).val()&&o.push(r(this).val())}),r.each(e,function(){var e=r(this).find("option"),t=r(this).val();r.each(e,function(){var e=r(this).val();e!==t&&(o.includes(e)?r(this).attr("disabled",!0):r(this).removeAttr("disabled"))})})},i.toggleUniqueIdCheckboxInRow=function(){var e=r("["+i.selectors.selectField+"]"),o=["content","excerpt","publish_date","publish_date_gmt","modified_date","modified_date_gmt"];r.each(e,function(){var e=r(this).parents("["+i.selectors.fieldRow+"]").find(".unique-field"),t=r(this).val();o.includes(t)||t.includes("taxonomy_")?r(e).css("visibility","hidden").find("input").removeAttr("checked"):r(e).removeAttr("style")})},i.toggleLoading=function(e){var t=r("["+i.selectors.loadingIndicator+"]"),o=r("["+i.selectors.columnSelection+"]");if(e)return r(t).show(),void r(o).hide();r(t).hide(),r(o).show()},i.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).Import=function(){var t=this,a=jQuery;return t.pause=!1,t.offset=parseInt(wpsl_locator.importoffset),t.completecount=parseInt(wpsl_locator.complete_count),t.errorcount=parseInt(wpsl_locator.error_count),t.imports_per_request=5,t.selectors={startButton:"data-simple-locator-import-start-button",pauseButton:"data-simple-locator-import-pause",intro:"data-simple-locator-import-intro",lastImported:"data-simple-locator-import-last-imported",progressMessage:"data-simple-locator-import-progress-message",progressBar:"data-simple-locator-import-progress-bar",progressBarBackground:"data-simple-locator-import-progress-bar-background",error:"data-simple-locator-import-error",errorCount:"data-simple-locator-import-error-count",progressCount:"data-simple-locator-import-progress-count",importComplete:"data-simple-locator-import-complete",totalCount:"data-simple-locator-import-total-count"},t.bindEvents=function(){a(document).on("click","["+t.selectors.startButton+"]",function(e){e.preventDefault(),t.startImport()}),a(document).on("click","["+t.selectors.pauseButton+"]",function(e){e.preventDefault(),t.pause=!t.pause;e=t.pause?wpsl_locator.pause_continue:wpsl_locator.pause;a(this).text(e),t.doImport()})},t.startImport=function(){a("["+t.selectors.intro+"],["+t.selectors.lastImported+"]").hide(),a("["+t.selectors.progressMessage+"]").show(),t.doImport()},t.doImport=function(){t.pause||a.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"wpsldoimport",nonce:wpsl_locator.locatorNonce,offset:t.offset,imports_per_request:t.imports_per_request},success:function(e){if(console.log(e),"testing"!==e.status){if("complete"!==e.status)return"error"===e.status?(a("["+t.selectors.error+"]").html("<p>"+e.message+"</p>").show(),void a("["+t.selectors.progressMessage+"]").hide()):void t.updateProgress(e);t.completeImport()}else console.log(e)},error:function(e){console.log(e)}})},t.updateProgress=function(e){t.completecount=t.completecount+e.import_count,t.offset=t.offset+e.import_count+e.failed_count,t.errorcount=t.errorcount+e.failed_count,a("["+t.selectors.progressCount+"]").text(t.completecount),a("["+t.selectors.errorCount+"]").text(t.errorcount);e=e.complete_rows/e.total_rows*100;a("["+t.selectors.progressBar+"]").width(e+"%"),t.doImport()},t.completeImport=function(){a("["+t.selectors.progressMessage+"]").hide(),a("["+t.selectors.importComplete+"]").show(),a.ajax({url:ajaxurl,type:"post",datatype:"json",data:{action:"wpslfinishimport"},success:function(e){a("["+t.selectors.totalCount+"]").text(e.import_count),a("["+t.selectors.errorCount+"]").text(e.error_count),0<e.errors.length&&t.appendErrorRows(e.errors)}})},t.appendErrorRows=function(e){for(var t=0;t<e.length;t++){var o="<tr><td>"+e[t].row+"</td><td>"+e[t].error+"</td></tr>";a(".wpsl-import-details table").append(o)}a(".wpsl-import-details").show()},t.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ListingMap=function(){var p=this,u=jQuery;return p.listings=[],p.markers=[],p.selectors={mapLink:"data-wpsl-listing-map-link",listingLatitude:"data-wpsl-post-latitude",listingLongitude:"data-wpsl-post-longitude",listingId:"data-wpsl-listing-post-id",listingTitle:"data-wpsl-post-title",listingEditLink:"data-wpsl-edit-link",listingViewLink:"data-wpsl-view-link",listingInfoWindow:"data-wpsl-post-infowindow"},p.bindEvents=function(){u(document).ready(function(){"1"===wpsl_locator.show_listing_map&&"1"===wpsl_locator.edit_listing&&(u(".wp-list-table").length<1||(p.addMapElement(),p.setListings()))}),u(document).on("click","["+p.selectors.mapLink+"]",function(e){e.preventDefault(),p.openInfoWindow(u(this))})},p.addMapElement=function(){u('<div class="wpsl-post-listing-map" id="wpsl-post-listing-map"></div>').insertBefore(".wp-list-table")},p.setListings=function(){var e=u(".wp-list-table tbody tr");u.each(e,function(e,t){var o=u(this).find("["+p.selectors.mapLink+"]");u(o).attr(p.selectors.mapLink,e);e={id:u(o).attr(p.selectors.listingId),title:u(o).attr(p.selectors.listingTitle),editLink:u(o).attr(p.selectors.listingEditLink),viewLink:u(o).attr(p.selectors.listingViewLink),latitude:u(o).attr(p.selectors.listingLatitude),longitude:u(o).attr(p.selectors.listingLongitude)},o=u(o).siblings("["+p.selectors.listingInfoWindow+"]").html();o+="<p>",o+='<a href="'+e.editLink+'" class="button">'+wpsl_locator.edit+"</a>",e.infowindow=o+="</p>",p.listings.push(e)}),p.loadMap()},p.loadMap=function(){for(var e=wpsl_locator.mapstyles,t=wpsl_locator.mappin||"",o=new google.maps.LatLngBounds,a=p.listings,l=u("#wpsl-post-listing-map"),e={mapTypeId:"roadmap",mapTypeControl:!1,zoom:8,styles:e,scrollwheel:!1,panControl:!1},s=new google.maps.InfoWindow,n=new google.maps.Map(l[0],e),i=0;i<a.length;i++){var r=new google.maps.LatLng(a[i].latitude,a[i].longitude);o.extend(r);r=new google.maps.Marker({position:r,map:n,title:a[i].title,icon:t});p.markers.push(r),google.maps.event.addListener(r,"click",function(e,t){return function(){s.setContent(a[t].infowindow),s.open(n,e)}}(r,i)),n.fitBounds(o);var c=google.maps.event.addListener(n,"idle",function(){a.length<2&&n.setZoom(13),google.maps.event.removeListener(c)})}var d=google.maps.event.addListener(n,"bounds_changed",function(e){google.maps.event.removeListener(d)})},p.openInfoWindow=function(e){e=u(e).attr(p.selectors.mapLink);google.maps.event.trigger(p.markers[e],"click")},p.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).ExportTemplates=function(){var o=this,d=jQuery;return o.selectors={loadBtn:"data-wpsl-export-template-load",deleteBtn:"data-wpsl-export-template-delete"},o.bindEvents=function(){d(document).on("click","["+o.selectors.loadBtn+"]",function(e){e.preventDefault(),o.loadTemplate(d(this))}),d(document).on("click","["+o.selectors.deleteBtn+"]",function(e){e.preventDefault(),o.deleteTemplate(d(this))})},o.loadTemplate=function(e){e=d(e).attr(o.selectors.loadBtn);d.ajax({type:"GET",url:ajaxurl,data:{action:"wpslexporttemplates",nonce:wpsl_locator.locatorNonce,templateKey:e},success:function(e){o.populateTemplate(e.templates)}})},o.populateTemplate=function(e){var t=e.standard_columns,o=e.custom_columns,a=e.include_header,l=(e.name,e.column_names),s=e.taxonomies,n=e.taxonomy_separator;d('input[name="standard_columns[]"]').removeAttr("checked");for(var i=0;i<t.length;i++){var r=d('input[name="standard_columns[]"][value="'+t[i]+'"]');d(r).attr("checked",!0)}d('input[name="custom_columns[]"]').removeAttr("checked");for(var c,i=0;i<o.length;i++){r=d('input[name="custom_columns[]"][value="'+o[i]+'"]');d(r).attr("checked",!0)}for(c in l)d('input[name="column_name['+c+"]").val(l[c]);if(d('input[name="taxonomies[]"').removeAttr("checked"),void 0!==s&&""!==s)for(i=0;i<s.length;i++){r=d('input[name="taxonomies[]"][value="'+s[i]+'"]');d(r).attr("checked",!0)}a?d('input[name="include_header_row"]').attr("checked",!0):d('input[name="include_header_row"]').removeAttr("checked"),d('select[name="taxonomy_separator"]').val(n);e=e.filename.replace(".csv","");d('input[name="file_name"]').val(e)},o.deleteTemplate=function(t){var e=d(t).attr(o.selectors.deleteBtn);d.ajax({type:"GET",url:ajaxurl,data:{action:"wpslexporttemplatedelete",nonce:wpsl_locator.locatorNonce,templateKey:e},success:function(e){d(t).parent("li").fadeOut("normal",function(){d(this).remove()})}})},o.bindEvents()},(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).QuickEdit=function(){var i=this,r=jQuery;return i.map=!1,i.mapMarker=!1,i.customMarkerPosition={custom:!1},i.fields=[["address","Address"],["address_two","Address Line 2"],["city","City"],["state","State"],["zip","Zip"],["country","Country"],["phone","Phone"],["website","Website"]],i.activeItem,i.formData,i.geocoded=!1,i.selectors={quickEditContainer:".simple-locator-quick-edit",editLink:"data-simple-locator-quick-edit",submitButton:"data-simple-locator-quick-edit-submit",cancelButton:"data-simple-locator-quick-edit-cancel",previewButton:"data-simple-locator-quick-edit-preview",error:"data-simple-locator-quick-edit-error",loading:".simple-locator-quick-edit-spinner",map:"data-simple-locator-quick-edit-map"},i.bindEvents=function(){r(document).on("click","["+i.selectors.editLink+"]",function(e){e.preventDefault(),i.clearQuickEdit(),i.activeItem=r(this),i.openForm()}),r(document).on("click","["+i.selectors.cancelButton+"]",function(e){e.preventDefault(),i.clearQuickEdit()}),r(document).on("click","["+i.selectors.submitButton+"]",function(e){e.preventDefault(),i.loading(!0),i.prepareFormData(!1)}),r(document).on("simple-locator-quick-edit-complete",function(e,t,o,a){i.completed(t,o,a)}),r(document).on("keyup",function(e){"Escape"===e.key&&0<r(i.selectors.quickEditContainer).length&&i.clearQuickEdit()}),r(document).on("click","["+i.selectors.previewButton+"]",function(e){e.preventDefault(),i.preview()})},i.openForm=function(){var e='<tr class="simple-locator-quick-edit"><td colspan="'+(r(i.activeItem).parents("tr").find("td").length+r(i.activeItem).parents("tr").find("th").length)+'">';e+="<h3>"+r(i.activeItem).attr("data-title")+"</h3>",e+='<div class="simple-locator-quick-edit-alert" '+i.selectors.error+"></div>",e+='<div class="inner">',e+='<div class="fields">';for(var t=0;t<wpsl_locator.form_fields_order.length;t++)if("map"!=(s=wpsl_locator.form_fields_order[t])&&"latlng"!=s&&"additionalInfo"!=s){var o=wpsl_locator.form_fields[s];if(void 0!==o){var a,l=r(i.activeItem).attr("data-"+s);if(void 0===l&&(l=""),e+='<div class="field"><label>'+o.label+"</label>","text"===o.type&&(a='<input type="text" ',a+=i.attributes(o),e+=a+='value="'+l+'" />'),"select"===o.type){var s,n="<select";for(s in n+=i.attributes(o),n+=">",o.choices)n+='<option value="'+s+'"',s===l&&(n+=" selected"),n+=">"+o.choices[s]+"</option>";e+=n+="</select>"}e+="</div>"}}e+="</div>\x3c!-- .fields --\x3e",e+='<div class="map" data-simple-locator-quick-edit-map></div>',e+="</div>\x3c!-- .inner --\x3e",e+='<div class="buttons">',e+='<button class="button" '+i.selectors.cancelButton+">"+wpsl_locator.cancel+"</button>",e+='<button class="button button-primary" '+i.selectors.submitButton+">"+wpsl_locator.save+"</button>",e+='<button class="button" '+i.selectors.previewButton+">"+wpsl_locator.preview+"</button>",e+='<div class="simple-locator-quick-edit-spinner"><div class="wpsl-icon-spinner-image"><img src="'+wpsl_locator.loading_spinner+'" class="wpsl-spinner-image" /></div></div>',e+="</div>\x3c!-- .buttons --\x3e",e+="</td></tr>\x3c!-- .dealer-quick-edit --\x3e",r(i.activeItem).parents("tr").hide(),r(e).insertAfter(r(i.activeItem).parents("tr")),r(document).trigger("simple-locator-quick-edit-opened",[i.activeItem]),i.loadMap(!0)},i.loadMap=function(e){var t;e&&(t=r(i.activeItem).attr("data-latitude"),l=r(i.activeItem).attr("data-longitude")),e||(t=i.formData.latitude,l=i.formData.longitude);var o=r("["+i.selectors.map+"]"),a=wpsl_locator.mapstyles,e=wpsl_locator.mappin||"",l=new google.maps.LatLng(t,l);i.map?(i.marker.setMap(null),i.map.setCenter(l)):i.map=new google.maps.Map(o[0],{mapTypeId:"roadmap",mapTypeControl:!1,zoom:12,styles:a,scrollwheel:!1,panControl:!1,center:l}),i.marker=new google.maps.Marker({position:l,map:i.map,icon:e,draggable:!0}),google.maps.event.addListener(i.marker,"drag",function(){i.customMarkerPosition.latitude=i.marker.position.lat(),i.customMarkerPosition.longitude=i.marker.position.lng(),i.customMarkerPosition.custom=!0})},i.prepareFormData=function(e){r("["+i.selectors.error+"]").hide(),i.formData={action:"wpslquickedit",id:r(i.activeItem).attr(i.selectors.editLink)};for(var t=0;t<i.fields.length;t++){var o=i.fields[t][0];i.formData[o]=r("[data-quickedit-"+o+"]").val()}i.geocodeAddress(e)},i.preview=function(){i.initialLoad=!1,i.prepareFormData(!0)},i.geocodeAddress=function(o){for(var e="",t=0;t<i.fields.length;t++){var a=i.fields[t][0];"address_two"!==a&&(e+=i.formData[a]+" ")}geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,t){t==google.maps.GeocoderStatus.OK?(i.formData.latitude=e[0].geometry.location.lat(),i.formData.longitude=e[0].geometry.location.lng(),i.geocoded=!0):i.geocoded=!1,o?i.loadMap(!1):i.submitForm()})},i.submitForm=function(){i.customMarkerPosition.custom&&(i.formData.latitude=i.customMarkerPosition.latitude,i.formData.longitude=i.customMarkerPosition.longitude),i.formData.custom_geo=i.customMarkerPosition.custom,r.ajax({type:"GET",url:ajaxurl,data:i.formData,success:function(e){i.loading(!1),"error"!==e.status?r(document).trigger("simple-locator-quick-edit-complete",[i.formData,i.activeItem,i.geocoded]):r("["+i.selectors.error+"]").text(e.message).show()},error:function(e){console.log(e)}})},i.completed=function(e,t,o){for(var a=0;a<i.fields.length;a++){var l="data-"+i.fields[a][0],s=i.formData[i.fields[a][0]];r(t).attr(l,s)}o?(r(t).attr("data-latitude",i.formData.latitude),r(t).attr("data-longitude",i.formData.longitude),r(t).parents("tr").show(),i.clearQuickEdit()):r("["+i.selectors.error+"]").text(wpsl_locator.quickedit_geocode_error).show()},i.clearQuickEdit=function(){i.map=!1,i.mapMarker=!1,i.customMarkerPosition.custom=!1,r("tr").show(),r(i.selectors.quickEditContainer).remove()},i.attributes=function(e){if(html="",!(e.attributes.length<1)){for(var t=0;t<e.attributes.length;t++){var o=e.attributes[t];"string"!=typeof o?html+=" "+o.attr+'="'+o.value+'"':html+=" "+o}return html}},i.loading=function(e){if(e)return r(i.selectors.loading).show(),void r("["+i.selectors.submitButton+"]").attr("disabled",!0);r("["+i.selectors.submitButton+"]").removeAttr("disabled"),r(i.selectors.loading).hide()},i.bindEvents()},jQuery(document).ready(function(){new SimpleLocatorAdmin.Factory}),(SimpleLocatorAdmin=SimpleLocatorAdmin||{}).endpoints={};var editScreenGoogleApiError=!(SimpleLocatorAdmin.Factory=function(){jQuery;return this.init=function(){new SimpleLocatorAdmin.Modals,new SimpleLocatorAdmin.PostEdit,new SimpleLocatorAdmin.GeneralSettings,new SimpleLocatorAdmin.PostType,new SimpleLocatorAdmin.MapDisplay,new SimpleLocatorAdmin.ResultsDisplay,new SimpleLocatorAdmin.DefaultMap,new SimpleLocatorAdmin.SearchHistory,new SimpleLocatorAdmin.ImportTest,new SimpleLocatorAdmin.ImportUpload,new SimpleLocatorAdmin.ImportColumnMap,new SimpleLocatorAdmin.Import,new SimpleLocatorAdmin.ListingMap,new SimpleLocatorAdmin.ExportTemplates,new SimpleLocatorAdmin.QuickEdit},this.init()});function gm_authFailure(e){editScreenGoogleApiError=!0}